(function(){Slideshow=new Class({Implements:[Chain,Events,Options],options:{accesskeys:null,captions:false,center:true,classes:[],controller:false,data:null,delay:2e3,duration:1e3,fast:false,height:false,href:"",hu:"",linked:false,loader:true,loop:true,match:/\?slide=(\d+)$/,overlap:true,paused:false,random:false,replace:[/(\.[^\.]+)$/,"t$1"],resize:"fill",slide:0,thumbnails:false,titles:false,transition:"sine:in:out",width:false},initialize:function(e,f,g){this.setOptions(g);this.el=document.id(e);if(!this.el)return;var h=window.location.href.match(this.options.match);this.slide=this._slide=this.options.match&&h?h[1].toInt():this.options.slide;this.counter=this.delay=this.duration=0;this.direction="left";this.cache={};this.paused=false;if(!this.options.overlap)this.options.duration*=2;var i=this.el.getElement("a")||new Element("a");if(!this.options.href)this.options.href=i.get("href")||"";if(this.options.hu.length&&!this.options.hu.test(/\/$/))this.options.hu+="/";if(this.options.fast===true)this.options.fast=2;var j="slideshow first prev play pause next last images captions controller thumbnails hidden visible inactive active loader".split(" "),k=j.map(function(a,b){return this.options.classes[b]||a},this);this.classes=k.associate(j);this.classes.get=function(){var a="."+this.slideshow;for(var b=0,c=arguments.length;b<c;b++)a+="-"+this[arguments[b]];return a}.bind(this.classes);if(!f){this.options.hu="";f={};var l=this.el.getElements(this.classes.get("thumbnails")+" img");this.el.getElements(this.classes.get("images")+" img").each(function(a,b){var c=a.src,d=a.alt||a.title,e=a.getParent().href,g=l[b]?l[b].src:"";f[c]={caption:d,href:e,thumbnail:g}})}var m=this.load(f);if(!m)return;this.events={};this.events.push=function(a,b){if(!this[a])this[a]=[];this[a].push(b);document.addEvent(a,b);return this}.bind(this.events);this.accesskeys={};for(action in this.options.accesskeys){var n=this.options.accesskeys[action];this.accesskeys[action]=accesskey={label:n.label};["shift","control","alt"].each(function(a){var b=new RegExp(a,"i");accesskey[a]=n.key.test(b);n.key=n.key.replace(b,"")});accesskey.key=n.key.trim()}this.events.push("keyup",function(a){Object.each(this.accesskeys,function(b,c){if(a.key==b.key&&a.shift==b.shift&&a.control==b.control&&a.alt==b.alt)this[c]()},this)}.bind(this));var e=this.el.getElement(this.classes.get("images")),o=this.el.getElement("img")||new Element("img"),p=e?e.empty():(new Element("div",{"class":this.classes.get("images").substr(1)})).inject(this.el),q=p.getSize();this.height=this.options.height||q.y;this.width=this.options.width||q.x;p.set({styles:{height:this.height,width:this.width}});this.el.store("images",p);this.a=this.image=o;if(Browser.ie&&Browser.version>=7)this.a.style.msInterpolationMode="bicubic";this.a.set("styles",{display:"none"});this.b=this.a.clone();[this.a,this.b].each(function(a){i.clone().cloneEvents(i).grab(a).inject(p)});if(this.options.captions)new a(this);if(this.options.controller)new b(this);if(this.options.loader)new c(this);if(this.options.thumbnails)new d(this);this._preload()},go:function(a,b){if((this.slide+this.data.images.length)%this.data.images.length==a||Date.now()<this.duration)return;clearTimeout(this.timer);this.delay=0;this.direction=b?b:a<this._slide?"right":"left";this.slide=this._slide=a;if(this.preloader)this.preloader=this.preloader.destroy();this._preload(this.options.fast==2||this.options.fast==1&&this.paused)},first:function(){this.prev(true)},prev:function(a){var b=0;if(!a){if(this.options.random){if(this.showed.i<2)return;this.showed.i-=2;b=this.showed.array[this.showed.i]}else b=(this.slide-1+this.data.images.length)%this.data.images.length}this.go(b,"right")},pause:function(a){if(a!=undefined)this.paused=a?false:true;if(this.paused){this.paused=false;this.duration=Date.now()+this.duration;this.timer=this._preload.delay(100,this);[this.a,this.b].each(function(a){["morph","tween"].each(function(a){if(this.retrieve(a))this.get(a).resume()},a)});if(this.controller)this.el.retrieve("pause").getParent().removeClass(this.classes.play)}else{this.paused=true;this.duration=this.duration-Date.now();clearTimeout(this.timer);[this.a,this.b].each(function(a){["morph","tween"].each(function(a){if(this.retrieve(a))this.get(a).pause()},a)});if(this.controller)this.el.retrieve("pause").getParent().addClass(this.classes.play)}},next:function(a){var b=a?this.data.images.length-1:this._slide;this.go(b,"left")},last:function(){this.next(true)},load:function(a){this.firstrun=true;this.showed={array:[],i:0};if(typeOf(a)=="array"){this.options.captions=false;a=(new Array(a.length)).associate(a.map(function(a,b){return a+"?"+b}))}this.data={images:[],captions:[],hrefs:[],thumbnails:[],targets:[],titles:[]};for(var b in a){var c=a[b]||{},b=this.options.hu+b,d=c.caption?c.caption.trim():"",e=c.href?c.href.trim():this.options.linked?b:this.options.href,f=c.target?c.target.trim():"_self",g=c.thumbnail?this.options.hu+c.thumbnail.trim():b.replace(this.options.replace[0],this.options.replace[1]),h=d.replace(/<.+?>/gm,"").replace(/</g,"<").replace(/>/g,">").replace(/"/g,"'");this.data.images.push(b);this.data.captions.push(d);this.data.hrefs.push(e);this.data.targets.push(f);this.data.thumbnails.push(g);this.data.titles.push(h)}if(this.options.random)this.slide=this._slide=Number.random(0,this.data.images.length-1);if(this.options.thumbnails&&this.el.retrieve("thumbnails"))this._thumbnails();if(this.el.retrieve("images")){[this.a,this.b].each(function(a){["morph","tween"].each(function(a){if(this.retrieve(a))this.get(a).cancel()},a)});this.slide=this._slide=this.duration=0;this.go(0)}return this.data.images.length},destroy:function(a){Object.each(this.events,function(a,b){if("each"in a)a.each(function(a){document.removeEvent(b,a)})});this.pause(1);"caption loader thumbnails".split(" ").each(function(a,b){this.options[a]&&(b=this[a].retrieve("timer"))&&clearTimeout(b)},this);typeOf(this.el[a])=="function"&&this.el[a]();delete this.el.uid},_preload:function(a){var b=this.data.images[this._slide].replace(/([^?]+).*/,"$1"),c=loaded=!!this.cache[b];if(!c){if(!this.preloader)this.preloader=new Asset.image(b,{onerror:function(){},onload:function(){this.store("loaded",true)}});loaded=this.preloader.retrieve("loaded")&&this.preloader.get("width")}if(loaded&&Date.now()>this.delay&&Date.now()>this.duration){var b=this.data.images[this._slide].replace(/([^?]+).*/,"$1");if(this.preloader){this.cache[b]={height:this.preloader.get("height"),src:b,width:this.preloader.get("width")}}if(this.stopped){if(this.options.captions)this.caption.get("morph").cancel().start(this.classes.get("captions","hidden"));this.pause(1);if(this.end)this.fireEvent("end");this.stopped=this.end=false;return}this.image=this.counter%2?this.b:this.a;this.image.set("styles",{display:"block",height:null,visibility:"hidden",width:null,zIndex:this.counter});this.image.set(this.cache[b]);this.image.width=this.cache[b].width;this.image.height=this.cache[b].height;if(this.options.resize)this._resize(this.image);if(this.options.center)this._center(this.image);var d=this.image.getParent();if(this.data.hrefs[this._slide]){d.set("href",this.data.hrefs[this._slide]);d.set("target",this.data.targets[this._slide])}else{d.erase("href");d.erase("target")}var e=this.data.titles[this._slide];this.image.set("alt",e);if(this.options.titles)d.set("title",e);if(this.options.loader)this.loader.fireEvent("hide");if(this.options.captions)this.caption.fireEvent("update",a);if(this.options.thumbnails)this.thumbnails.fireEvent("update",a);this._show(a);this._loaded()}else{if(Date.now()>this.delay&&this.options.loader)this.loader.fireEvent("show");this.timer=this._preload.delay(50,this,a)}},_show:function(a){if(!this.image.retrieve("morph")){var b=this.options.overlap?{duration:this.options.duration,link:"cancel"}:{duration:this.options.duration/2,link:"chain"};$$(this.a,this.b).set("morph",Object.merge(b,{onStart:this._start.bind(this),onComplete:this._complete.bind(this),transition:this.options.transition}))}var c=this.classes.get("images",this.direction=="left"?"next":"prev"),d=this.classes.get("images","visible"),e=this.counter%2?this.a:this.b;if(a){e.get("morph").cancel().set(c);this.image.get("morph").cancel().set(d)}else{if(this.options.overlap){e.get("morph").set(d);this.image.get("morph").set(c).start(d)}else{var f=function(a){this.image.get("morph").start(a)}.pass(d,this);if(this.firstrun)return f();c=this.classes.get("images",this.direction=="left"?"prev":"next");this.image.get("morph").set(c);e.get("morph").set(d).start(c).chain(f)}}},_loaded:function(){this.counter++;this.delay=Date.now()+this.options.duration+this.options.delay;this.direction="left";this.duration=this.options.fast==2||this.options.fast==1&&this.paused?0:Date.now()+this.options.duration;if(this._slide==this.data.images.length-1&&!this.options.loop&&!this.options.random)this.stopped=this.end=true;if(this.options.random){this.showed.i++;if(this.showed.i>=this.showed.array.length){var a=this._slide;if(this.showed.array.getLast()!=a)this.showed.array.push(a);while(this._slide==a)this.slide=this._slide=Number.random(0,this.data.images.length-1)}else this.slide=this._slide=this.showed.array[this.showed.i]}else{this.slide=this._slide;this._slide=(this.slide+1)%this.data.images.length}if(this.image.getStyle("visibility")!="visible")(function(){this.image.setStyle("visibility","visible")}).delay(1,this);if(this.preloader)this.preloader=this.preloader.destroy();this._preload()},_center:function(a){var b=a.getSize(),c=b.y,d=b.x;a.set("styles",{left:(d-this.width)/-2,top:(c-this.height)/-2})},_resize:function(a){var b=a.get("height").toFloat(),c=a.get("width").toFloat(),d=this.height/b,e=this.width/c;if(this.options.resize=="fit")d=e=d>e?e:d;if(this.options.resize=="fill")d=e=d>e?d:e;a.set("styles",{height:Math.ceil(b*d),width:Math.ceil(c*e)})},_start:function(){this.fireEvent("start")},_complete:function(){if(this.firstrun&&this.options.paused||this.paused){this.pause(1)}this.firstrun=false;this.fireEvent("complete")}});var a=new Class({Implements:[Chain,Events,Options],options:{delay:0,link:"cancel"},initialize:function(a){if(!a)return;var b=a.options.captions;if(b===true)b={};this.setOptions(b);var c=a.el.getElement(a.classes.get("captions")),d=c?c.dispose().empty():new Element("div",{"class":a.classes.get("captions").substr(1)});a.caption=d;d.set({"aria-busy":false,"aria-hidden":false,events:{update:this.update.bind(a)},morph:this.options,role:"description"}).store("delay",this.options.delay);if(!d.get("id"))d.set("id","Slideshow-"+Date.now());a.el.retrieve("images").set("aria-labelledby",d.get("id"));d.inject(a.el)},update:function(a){var b=!this.data.captions[this._slide].length,c;if(c=this.caption.retrieve("timer"))clearTimeout(c);if(a){var d=b?"hidden":"visible";this.caption.set({"aria-hidden":b,html:this.data.captions[this._slide]}).get("morph").cancel().set(this.classes.get("captions",d))}else{var e=b?function(){}:function(a){this.caption.store("timer",setTimeout(function(a){this.caption.set("html",a).morph(this.classes.get("captions","visible"))}.pass(a,this),this.caption.retrieve("delay")))}.pass(this.data.captions[this._slide],this);var f=function(){this.caption.set("aria-busy",false)}.bind(this);this.caption.set("aria-busy",true).get("morph").cancel().start(this.classes.get("captions","hidden")).chain(e,f)}}});var b=new Class({Implements:[Chain,Events,Options],options:{link:"cancel"},initialize:function(a){if(!a)return;var b=a.options.captions;if(b===true)b={};this.setOptions(b);var c=a.el.getElement(a.classes.get("controller")),d=c?c.dispose().empty():new Element("div",{"class":a.classes.get("controller").substr(1)});a.controller=d;d.set({"aria-hidden":false,role:"menubar"});var e=(new Element("ul",{role:"menu"})).inject(d),f=0;Object.each(a.accesskeys,function(a,b){var c=(new Element("li",{"class":b=="pause"&&this.options.paused?this.classes.play+" "+this.classes[b]:this.classes[b]})).inject(e);var d=this.el.retrieve(b,(new Element("a",{role:"menuitem",tabindex:f++,title:a.label})).inject(c));d.set("events",{click:function(a){this[a]()}.pass(b,this),mouseenter:function(a){this.addClass(a)}.pass(this.classes.active,d),mouseleave:function(a){this.removeClass(a)}.pass(this.classes.active,d)})},a);d.set({events:{hide:this.hide.pass(a.classes.get("controller","hidden"),d),show:this.show.pass(a.classes.get("controller","visible"),d)},morph:this.options}).store("hidden",false);a.events.push("keydown",this.keydown.bind(a)).push("keyup",this.keyup.bind(a)).push("mousemove",this.mousemove.bind(a));d.inject(a.el).fireEvent("hide")},hide:function(a){if(this.get("aria-hidden")=="false")this.set("aria-hidden",true).morph(a)},keydown:function(a){Object.each(this.accesskeys,function(b,c){if(a.key==b.key&&a.shift==b.shift&&a.control==b.control&&a.alt==b.alt){if(this.controller.get("aria-hidden")=="true")this.controller.get("morph").set(this.classes.get("controller","visible"));this.el.retrieve(c).fireEvent("mouseenter")}},this)},keyup:function(a){Object.each(this.accesskeys,function(b,c){if(a.key==b.key&&a.shift==b.shift&&a.control==b.control&&a.alt==b.alt){if(this.controller.get("aria-hidden")=="true")this.controller.set("aria-hidden",false).fireEvent("hide");this.el.retrieve(c).fireEvent("mouseleave")}},this)},mousemove:function(a){var b=this.el.retrieve("images").getCoordinates(),c=a.page.x>b.left&&a.page.x<b.right&&a.page.y>b.top&&a.page.y<b.bottom?"show":"hide";this.controller.fireEvent(c)},show:function(a){if(this.get("aria-hidden")=="true")this.set("aria-hidden",false).morph(a)}});var c=new Class({Implements:[Chain,Events,Options],options:{fps:20,link:"cancel"},initialize:function(a){if(!a)return;var b=a.options.loader;if(b===true)b={};this.setOptions(b);var c=(new Element("div",{"aria-hidden":false,"class":a.classes.get("loader").substr(1),morph:this.options,role:"progressbar"})).store("animate",false).store("i",0).store("delay",1e3/this.options.fps).inject(a.el);a.loader=c;var d=c.getStyle("backgroundImage").replace(/url\(['"]?(.*?)['"]?\)/,"$1").trim();if(d){if(d.test(/\.png$/)&&Browser.ie&&Browser.version<7)c.setStyles({backgroundImage:"none",filter:'progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+d+'", sizingMethod="crop")'});new Asset.image(d,{onload:function(){var a=c.getSize(),b=this.get("width"),d=this.get("height");if(b>a.x)c.store("x",a.x).store("animate","x").store("frames",(b/a.x).toInt());if(d>a.y)c.store("y",a.y).store("animate","y").store("frames",(d/a.y).toInt())}})}c.set("events",{animate:this.animate.bind(c),hide:this.hide.pass(a.classes.get("loader","hidden"),c),show:this.show.pass(a.classes.get("loader","visible"),c)});c.fireEvent("hide")},animate:function(){var a=this.retrieve("animate");if(!a)return;var b=(this.retrieve("i").toInt()+1)%this.retrieve("frames");this.store("i",b);var c=b*this.retrieve(a)+"px";if(a=="x")this.setStyle("backgroundPosition",c+" 0px");if(a=="y")this.setStyle("backgroundPosition","0px "+c)},hide:function(a){if(this.get("aria-hidden")=="false"){this.set("aria-hidden",true).morph(a);if(this.retrieve("animate"))clearTimeout(this.retrieve("timer"))}},show:function(a){if(this.get("aria-hidden")=="true"){this.set("aria-hidden",false).morph(a);if(this.retrieve("animate")){this.store("timer",function(){this.fireEvent("animate")}.periodical(this.retrieve("delay"),this))}}}});var d=new Class({Implements:[Chain,Events,Options],options:{columns:null,fps:50,link:"cancel",position:null,rows:null,scroll:null},initialize:function(a){var b=a.options.thumbnails===true?{}:a.options.thumbnails;this.setOptions(b);var c=a.el.getElement(a.classes.get("thumbnails")),d=c?c.empty():new Element("div",{"class":a.classes.get("thumbnails").substr(1)});a.thumbnails=d;d.set({role:"menubar",styles:{overflow:"hidden"}});var e=d.retrieve("uid","Slideshow-"+Date.now()),f=(new Element("ul",{role:"menu",styles:{left:0,position:"absolute",top:0},tween:{link:"cancel"}})).inject(d);a.data.thumbnails.each(function(b,c){var d=(new Element("li",{id:e+c})).inject(f),g=(new Element("a",{"class":a.classes.get("thumbnails","hidden").substr(1),events:{click:this.click.pass(c,a)},href:a.data.images[c],morph:this.options,role:"menuitem",tabindex:c})).store("uid",c).inject(d);if(a.options.titles)g.set("title",a.data.titles[c]);(new Asset.image(b,{onload:this.onload.pass(c,a)})).inject(g)},this);d.set("events",{scroll:this.scroll.bind(d),update:this.update.bind(a)});var g=d.getCoordinates();if(!b.scroll)b.scroll=g.height>g.width?"y":"x";var h=b.scroll=="y"?"top bottom height y width".split(" "):"left right width x height".split(" ");d.store("props",h).store("delay",1e3/this.options.fps);a.events.push("mousemove",this.mousemove.bind(d));d.inject(a.el)},click:function(a){this.go(a);return false},mousemove:function(a){var b=this.getCoordinates();if(a.page.x>b.left&&a.page.x<b.right&&a.page.y>b.top&&a.page.y<b.bottom){this.store("page",a.page);if(!this.retrieve("mouseover")){this.store("mouseover",true);this.store("timer",function(){this.fireEvent("scroll")}.periodical(this.retrieve("delay"),this))}}else{if(this.retrieve("mouseover")){this.store("mouseover",false);clearTimeout(this.retrieve("timer"))}}},onload:function(a){var b=this.thumbnails,c=b.getElements("a")[a];if(c){(function(b){var c=a==this.slide?"active":"inactive";b.store("loaded",true).get("morph").set(this.classes.get("thumbnails","hidden")).start(this.classes.get("thumbnails",c))}).delay(Math.max(1e3/this.data.thumbnails.length,100),this,c)}if(b.retrieve("limit"))return;var d=b.retrieve("props"),e=this.options.thumbnails,f=d[1],g=d[2],h=d[4],i=b.getElement("li:nth-child("+(a+1)+")").getCoordinates();if(e.columns||e.rows){b.setStyles({height:this.height,width:this.width});if(e.columns.toInt())b.setStyle("width",i.width*e.columns.toInt());if(e.rows.toInt())b.setStyle("height",i.height*e.rows.toInt())}var j=b.getCoordinates();if(e.position){if(e.position.test(/bottom|top/))b.setStyles({bottom:"auto",top:"auto"}).setStyle(e.position,-j.height);if(e.position.test(/left|right/))b.setStyles({left:"auto",right:"auto"}).setStyle(e.position,-j.width)}var k=Math.floor(j[h]/i[h]),l=Math.ceil(this.data.images.length/k),m=this.data.images.length%k,n=l*i[g],o=b.getElement("ul").setStyle(g,n);o.getElements("li").setStyles({height:i.height,width:i.width});b.store("limit",j[g]-n)},scroll:function(a,b){var c=this.getCoordinates(),d=this.getElement("ul").getPosition(),e=this.retrieve("props"),f=e[3],g,h=e[0],i=e[2],j,k=this.getElement("ul").set("tween",{property:h}).get("tween");if(a!=undefined){var l=this.retrieve("uid"),m=document.id(l+a).getCoordinates();g=c[h]+c[i]/2-m[i]/2-m[h];j=(d[f]-c[h]+g).limit(this.retrieve("limit"),0);if(b)k.set(j);else k.start(j)}else{var n=c[e[2]]/3,o=this.retrieve("page"),p=-(this.retrieve("delay")*.01);if(o[f]<c[h]+n)g=(o[f]-c[h]-n)*p;else if(o[f]>c[h]+c[i]-n)g=(o[f]-c[h]-c[i]+n)*p;if(g){j=(d[f]-c[h]+g).limit(this.retrieve("limit"),0);k.set(j)}}},update:function(a){var b=this.thumbnails,c=b.retrieve("uid");b.getElements("a").each(function(b,c){if(b.retrieve("loaded")){if(b.retrieve("uid")==this._slide){if(!b.retrieve("active",false)){b.store("active",true);var d=this.classes.get("thumbnails","active");if(a)b.get("morph").set(d);else b.morph(d)}}else{if(b.retrieve("active",true)){b.store("active",false);var e=this.classes.get("thumbnails","inactive");if(a)b.get("morph").set(e);else b.morph(e)}}}},this);if(!b.retrieve("mouseover"))b.fireEvent("scroll",[this._slide,a])}})})()